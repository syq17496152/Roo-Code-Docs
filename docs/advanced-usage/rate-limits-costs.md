# 速率限制与成本

了解和管理 API 使用情况对于获得顺畅且经济高效的 Roo Code 体验至关重要。本节解释了如何跟踪您的令牌使用情况和成本。速率限制默认为 0（禁用），通常不需要调整，现在可以通过配置文件进行配置；有关如何设置的详细信息，请参阅 [API 配置文件](/features/api-configuration-profiles#创建配置文件) 文档。

---

## 令牌使用情况

Roo Code 使用令牌与 AI 模型进行交互。令牌本质上是单词的部分。请求和响应中的令牌数量会影响处理时间和成本。

*   **输入令牌：** 这些是您提示中的令牌，包括系统提示、您的指令和提供的任何上下文（例如，文件内容）。
*   **输出令牌：** 这些是 AI 模型在其响应中生成的令牌。

您可以在聊天历史记录中看到每次交互使用的输入和输出令牌数量。

---

## 成本计算

大多数 AI 提供商根据使用的令牌数量收费。价格因提供商和具体模型而异。

Roo Code 会根据配置模型的价格自动计算每次 API 请求的预估成本。此成本显示在聊天历史记录中，位于令牌使用情况旁边。

**注意：**

*   成本计算是一个*预估值*。实际成本可能会因提供商的计费方式略有不同。
*   一些提供商可能提供免费层级或信用额度。有关详细信息，请查看提供商的文档。
*   一些提供商提供提示缓存，这可以大大降低成本。

### 限制自动批准的请求

为了进一步帮助管理 API 成本并防止意外开支，Roo Code 包含一个 "最大请求" 设置，用于自动批准的操作。这允许您定义一个特定限制，Roo Code 在任务执行期间无需您的明确重新批准即可连续进行的 API 调用次数。

*   **工作原理：** 如果您设置了限制（例如，5 个请求），Roo Code 将执行最多 5 个自动批准的 API 调用。在进行第 6 个调用之前，它将暂停并提示您 "重置并继续"，如下所示。
    <img src="/img/v3.18.0/v3.18.0-1.png" alt="警告消息，指示已达到自动批准的请求限制。" width="600" />
    *当达到自动批准的请求限制时的通知。*
*   **配置：** 此限制在 "自动批准操作" 设置中配置。您可以设置一个特定数字或选择 "无限制"。有关配置此设置和其他自动批准设置的详细步骤，请参阅 [自动批准操作文档](/features/auto-approving-actions)。
    <img src="/img/v3.18.0/v3.18.0.png" alt="在 Roo Code 设置中设置自动批准操作的最大请求限制。" width="600" />
    *设置自动批准操作的 "最大请求" 限制。*

此功能提供了额外的安全保障，特别是对于涉及多次 API 调用的复杂或长时间运行的任务。

---

## 优化令牌使用的技巧

*   **简洁明了：** 在提示中使用清晰简洁的语言。避免不必要的词汇或细节。
*   **仅提供相关上下文：** 有选择地使用上下文引用（`@file.ts`, `@folder/`）。只包含直接相关的文件。
*   **分解任务：** 将大任务分解为更小、更专注的子任务。
*   **使用自定义指令：** 提供自定义指令以指导 Roo Code 的行为，减少每次提示中需要冗长解释的需求。
*   **选择合适的模型：** 有些模型比其他模型更具成本效益。考虑在不需要大型模型全部功能的任务中使用更小、更快的模型。
*   **使用模式：** 不同的模式可以访问不同的工具，例如 `Architect` 不能修改代码，这使其成为分析复杂代码库时的安全选择，而不必担心意外允许昂贵的操作。
*   **不使用时禁用 MCP：** 如果您未使用 MCP（模型上下文协议）功能，请考虑[在 MCP 设置中禁用它](/features/mcp/using-mcp-in-roo#启用或禁用-mcp-服务器创建) 以显著减少系统提示的大小并节省令牌。

通过了解和管理您的 API 使用情况，您可以有效地使用 Roo Code 并提高效率。