# new_task

`new_task` 工具通过创建具有专门模式的子任务来维护父子关系。它将复杂的项目分解为可管理的部分，每个部分在最适合特定工作的模式下运行。

---

## 参数

该工具接受以下参数：

- `mode` (必填)：新任务启动模式的标识符（例如 "code"、"ask"、"architect"）
- `message` (必填)：新任务的初始用户消息或指令

---

## 功能说明

此工具使用指定的起始模式和初始消息创建新任务实例。它允许将复杂的工作流程分解为具有自己对话历史的子任务。父任务在子任务执行期间暂停，并在子任务完成后恢复，结果会传递回父任务。

---

## 使用场景

- 将复杂项目分解为独立、专注的子任务时
- 任务的不同方面需要不同专门模式时
- 工作的不同阶段受益于上下文分离时
- 组织多阶段开发工作流时

---

## 主要功能

- 创建具有自己对话历史和专门模式的子任务
- 暂停父任务以便后续恢复
- 维护任务层级关系以方便导航
- 在完成时将结果传递回父任务
- 支持复杂项目的流程隔离
- 允许项目不同部分使用针对特定工作的优化模式
- 需要显式用户批准才能创建任务
- 在UI中提供清晰的任务转换

---

## 局限性

- 无法创建不存在模式的任务
- 每个新任务创建前都需要用户批准
- 深度嵌套的子任务可能导致任务界面复杂化
- 子任务继承父级的一些工作区和扩展配置
- 在深度嵌套的任务间切换时可能需要重新建立上下文
- 完成任务需要显式信号以正确返回到父任务

---

## 工作原理

当调用 `new_task` 工具时，它遵循以下流程：

1. **参数验证**：
   - 验证必需的 `mode` 和 `message` 参数
   - 验证请求的模式是否存在于系统中

2. **任务栈管理**：
   - 维护一个跟踪所有活动和暂停任务的任务栈
   - 保存当前模式以供稍后恢复
   - 将父任务设置为暂停状态

3. **任务上下文管理**：
   - 使用提供的消息创建新任务上下文
   - 分配唯一的 taskId 和 instanceId 标识符用于状态管理
   - 记录工具使用情况和任务生命周期的遥测数据

4. **模式切换与集成**：
   - 切换到具有适当角色和能力的指定模式
   - 使用提供的消息初始化新任务
   - 与 VS Code 的命令面板和代码操作集成

5. **任务完成与结果传输**：
   - 当子任务完成时，结果通过 `finishSubTask()` 传递回父任务
   - 父任务在其原始模式下恢复
   - 更新任务历史记录和令牌使用统计信息
   - 发出带有性能数据的 `taskCompleted` 事件

---

## 使用示例

- 当前端开发人员需要设计新功能、实现代码并进行文档化时，可以为每个阶段创建单独的任务，结果从一个阶段流向下一个阶段。
- 在实施修复之前调试问题时，调试任务可以记录传递给实现任务的发现。
- 开发全栈应用程序时，架构师模式任务中的数据库设计方案可以指导后续代码模式任务的实现细节。
- 在实现后编写文档时，文档任务可以引用已完成的实现，同时使用特定于文档的功能。

---

## 使用示例代码

在代码模式下创建新任务：
```
<new_task>
<mode>code</mode>
<message>实现包含登录、注册和密码重置功能的用户认证服务。</message>
</new_task>
```

在实现完成后创建文档任务：
```
<new_task>
<mode>docs</mode>
<message>为我们刚刚构建的认证服务创建全面的API文档。</message>
</new_task>
```

将复杂功能分解为架构规划和实现：
```
<new_task>
<mode>architect</mode>
<message>为我们新的电子商务平台设计数据库架构和系统架构。</message>
</new_task>