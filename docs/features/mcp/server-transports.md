---
title: MCP服务器传输机制
sidebar_label: STDIO、可流式HTTP与SSE传输
---

# MCP服务器传输机制：STDIO、可流式HTTP与SSE

模型上下文协议（MCP）支持Roo Code与MCP服务器通信的三种主要传输机制：标准输入/输出（STDIO）、可流式HTTP（现代标准）和服务器发送事件（SSE）（用于旧版）。每种机制都有其独特特性、优势和适用场景。

---

## STDIO传输机制

STDIO传输机制在本地运行并通过标准输入/输出流通信。

### STDIO传输机制工作原理

1. 客户端（Roo Code）将MCP服务器作为子进程启动
2. 通过进程流进行通信：客户端写入服务器的STDIN，服务器通过STDOUT响应
3. 每条消息以换行符分隔
4. 消息格式为JSON-RPC 2.0

```
客户端                    服务器
  |                         |
  |---- JSON消息 ------>| （通过STDIN）
  |                         | （处理请求）
  |<---- JSON消息 ------| （通过STDOUT）
  |                         |
```

### STDIO特性

* **本地性**：与Roo Code运行在同一台机器上
* **性能**：极低延迟和开销（无需网络栈）
* **简洁性**：直接的进程通信无需网络配置
* **关系**：客户端与服务器一对一关系
* **安全性**：本质更安全（无网络暴露）

### 何时使用STDIO

STDIO传输机制适用于：

* 本地集成和运行在同一台机器上的工具
* 安全敏感操作
* 低延迟需求
* 单客户端场景（每个服务器一个Roo Code实例）
* 命令行工具或IDE扩展

### STDIO实现示例

```typescript
import { Server } from '@modelcontextprotocol/sdk/server/index.js';
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';

const server = new Server({name: 'local-server', version: '1.0.0'});
// 注册工具...

// 使用STDIO传输机制
const transport = new StdioServerTransport(server);
transport.listen();
```
---

## 可流式HTTP传输机制

可流式HTTP传输机制是远程MCP服务器通信的现代标准，取代了旧版HTTP+SSE传输机制。它通过HTTP/HTTPS运行，允许更灵活的服务器实现。

### 可流式HTTP传输机制工作原理

1. 服务器提供一个支持POST和GET方法的单一HTTP端点（MCP端点）。
2. 客户端（Roo Code）使用HTTP POST向此MCP端点发送请求。
3. 服务器处理请求并发送响应。
4. 可选地，服务器可以通过SSE流经同一连接向客户端流式传输多条消息或通知。这允许基本请求-响应交互以及更高级的流式传输和服务器发起通信。

```
客户端                             服务器
  |                                  |
  |---- HTTP POST /mcp_endpoint ---->| （客户端请求）
  |                                  | （处理请求）
  |<--- HTTP响应 / SSE流 --| （服务器响应/流）
  |                                  |
```

### 可流式HTTP特性

* **现代标准**：新远程MCP服务器实现的首选方法。
* **远程访问**：可以托管在与Roo Code不同的机器上。
* **可扩展性**：可同时处理多个客户端连接。
* **协议**：通过标准HTTP/HTTPS运行。
* **灵活性**：支持简单请求-响应和高级流式传输。
* **单一端点**：所有MCP通信使用单一URL路径。
* **认证**：可使用标准HTTP认证机制。
* **向后兼容性**：服务器可保持与旧版HTTP+SSE客户端的兼容性。

### 何时使用可流式HTTP

可流式HTTP传输机制适用于：

* 所有新的远程MCP服务器开发。
* 需要健壮、可扩展和灵活通信的服务器。
* 可能涉及流式数据或服务器发送通知的集成。
* 公共服务或集中式工具。
* 替换旧版SSE传输机制实现。

### 可流式HTTP实现示例

`settings.json`中的配置：
```
{
  "mcp.servers": {
    "StreamableHTTPMCPName": {
      "type": "streamable-http",
      "url": "http://localhost:8080/mcp"
    }
  }
}
```

服务器端实现请参考MCP SDK文档中的`StreamableHTTPClientTransport`。

### 与HTTP+SSE的向后兼容性

客户端和服务器可以保持与旧版HTTP+SSE传输机制的兼容性（协议版本2024-11-05）。

支持旧客户端的服务器应：
* 继续托管旧传输机制的SSE（`/events`）和POST（`/message`）端点，同时提供新传输机制定义的“MCP端点”。

---

## SSE传输机制（旧版）

服务器发送事件（SSE）传输机制是通过HTTP/HTTPS进行远程通信的旧方法。对于新实现，**推荐使用可流式HTTP传输机制**。SSE仍可用于与旧版MCP服务器的兼容性。

### SSE传输机制工作原理

1. 客户端（Roo Code）通过HTTP GET请求连接服务器的SSE端点
2. 建立持久连接，服务器可通过此连接向客户端推送事件
3. 客户端到服务器通信，客户端通过单独端点发送HTTP POST请求
4. 通信通过两个通道进行：
    * 事件流（GET）：服务器到客户端更新
    * 消息端点（POST）：客户端到服务器请求

```
客户端                             服务器
  |                                  |
  |---- HTTP GET /events ----------->| （建立SSE连接）
  |<---- SSE事件流 -----------| （持久连接）
  |                                  |
  |---- HTTP POST /message --------->| （客户端请求）
  |<---- SSE事件包含响应 ----| （服务器响应）
  |                                  |
```

### SSE特性

* **远程访问**：可以托管在与Roo Code不同的机器上
* **可扩展性**：可同时处理多个客户端连接
* **协议**：通过标准HTTP运行（无需特殊协议）
* **持久性**：保持持久连接用于服务器到客户端消息
* **认证**：可使用标准HTTP认证机制

### 何时使用SSE

SSE传输机制适用于：

* 网络上的远程访问
* 多客户端场景
* 公共服务
* 多用户需要访问的集中式工具
* 与Web服务的集成

### SSE实现示例

```typescript
import { Server } from '@modelcontextprotocol/sdk/server/index.js';
import { SSEServerTransport } from '@modelcontextprotocol/sdk/server/sse.js';
import express from 'express';

const app = express();
const server = new Server({name: 'remote-server', version: '1.0.0'});
// 注册工具...

// 使用SSE传输机制
const transport = new SSEServerTransport(server);
app.use('/mcp', transport.requestHandler());
app.listen(3000, () => {
  console.log('MCP服务器正在监听3000端口');
});
```
---

## 本地与托管：部署方面

选择STDIO和SSE传输机制直接影响您如何部署和管理MCP服务器。

### STDIO：本地部署模型

STDIO服务器与Roo Code运行在同一台机器上，这有几个重要影响：

* **安装**：服务器可执行文件必须安装在每个用户的机器上
* **分发**：需要为不同操作系统提供安装包
* **更新**：每个实例必须单独更新
* **资源**：使用本地机器的CPU、内存和磁盘
* **访问控制**：依赖本地机器的文件系统权限
* **集成**：易于与本地系统资源集成（文件、进程）
* **执行**：随Roo Code启动和停止（子进程生命周期）
* **依赖**：依赖必须安装在用户机器上

#### 实用示例

使用STDIO的本地文件搜索工具会：
* 在用户机器上运行
* 直接访问本地文件系统
* 在Roo Code需要时启动
* 无需网络配置
* 需与Roo Code一起或通过包管理器安装

### 可流式HTTP/SSE（旧版）：托管部署模型

可流式HTTP（推荐）和旧版SSE服务器可以部署到远程服务器并通过网络访问：

* **安装**：在服务器上安装一次，供多个用户访问
* **分发**：单次部署服务多个客户端
* **更新**：集中更新立即影响所有用户
* **资源**：使用服务器资源，而非本地机器资源
* **访问控制**：通过身份验证和授权系统管理
* **集成**：与用户特定资源集成更复杂
* **执行**：作为独立服务运行（通常持续运行）
* **依赖**：在服务器上管理，而非用户机器

#### 实用示例

使用SSE的数据库查询工具会：
* 在中央服务器上运行
* 使用服务器端凭证连接数据库
* 为多个用户持续可用
* 需要适当的网络安全配置
* 通过容器或云技术部署

### 混合方法

某些场景适合混合方法：

1. **STDIO与网络访问**：作为本地STDIO服务器代理远程服务
2. **SSE与本地命令**：可触发客户端机器回调操作的远程SSE服务器
3. **网关模式**：用于本地操作的STDIO服务器连接SSE服务器执行特定功能

---

## 传输机制选择对比

| 考量 | STDIO | 可流式HTTP | SSE（旧版） |
|---------------|-------|-----------------|--------------|
| **位置** | 仅本地机器 | 本地或远程 | 本地或远程 |
| **客户端** | 单客户端 | 多客户端 | 多客户端 |
| **性能** | 更低延迟 | 更高延迟（网络开销） | 更高延迟（网络开销） |
| **设置复杂度** | 更简单 | 更复杂（需要HTTP服务器） | 更复杂（需要HTTP服务器，可能需要两个端点） |
| **安全性** | 本质安全 | 需要显式安全措施 | 需要显式安全措施 |
| **网络访问** | 无需 | 需要 | 需要 |
| **可扩展性** | 限于本地机器 | 可跨网络扩展 | 可跨网络扩展 |
| **部署** | 每用户安装 | 集中安装 | 集中安装 |
| **更新** | 分布式更新 | 集中更新 | 集中更新 |
| **资源使用** | 使用客户端资源 | 使用服务器资源 | 使用服务器资源 |
| **依赖** | 客户端依赖 | 服务器端依赖 | 服务器端依赖 |
| **推荐** | 本地、安全、单客户端工具的理想选择 | **新远程服务器的现代标准** | 旧版，用于现有旧服务器 |

---

## 在Roo Code中配置传输机制

有关在Roo Code中配置STDIO、可流式HTTP和SSE（旧版）传输机制的详细信息，包括配置示例，请参阅[理解传输类型](/features/mcp/using-mcp-in-roo#understanding-transport-types)部分.