// ... existing code ...

# 代码库索引

代码库索引通过AI嵌入技术创建语义搜索索引，彻底改变了Roo Code对您项目的理解方式。它不再搜索精确的文本匹配，而是理解查询的*含义*，帮助Roo找到相关代码，即使您不知道具体的函数名或文件位置。

<img src="/img/codebase-indexing/codebase-indexing-1.png" alt="代码库索引状态图标" />

---

## 它的功能

启用后，索引系统将执行以下操作：

1. **使用Tree-sitter解析代码**以识别语义块（函数、类、方法）
2. **为每个代码块创建嵌入** 使用AI模型
3. **在Qdrant数据库中存储向量**以实现快速相似性搜索
4. **提供[`codebase_search`](/advanced-usage/available-tools/codebase-search)工具给Roo用于智能代码发现

这使得自然语言查询如"用户认证逻辑"或"数据库连接处理"能够找到整个项目中相关的代码。

// ... existing code ...

### 设置字段

- **Embedder Provider**
  - **用途**：选择生成AI嵌入的来源。
  - **行为**：此下拉菜单决定显示哪些配置字段。您的选项是**OpenAI**、**Google Gemini**、**Ollama**和**OpenAI Compatible**。

- **API Key** (for OpenAI, Gemini, OpenAI Compatible)
  - **用途**：用于验证所选提供商的秘密密钥。
  - **行为**：此输入对于所有基于云的提供商都是必需的，并安全存储在您的VS Code加密存储中。

- **Base URL** (for Ollama, OpenAI Compatible)
  - **用途**：连接到提供商API的端点。
  - **行为**：对于**Ollama**，通常是`http://localhost:11434`。对于**OpenAI Compatible**提供商如Azure，这是完整的部署URL。

- **Model**
  - **用途**：选择要使用的特定嵌入模型。
  - **行为**：可用模型列表根据所选提供商而变化。模型的向量维度（例如`1536 dimensions`）会显示出来，因为更改维度需要完全重新索引。

- **Qdrant URL**
  - **用途**：Qdrant向量数据库的连接端点。
  - **行为**：必须是有效的URL，指向本地或基于云的Qdrant实例（例如`http://localhost:6333`）。

- **Qdrant API Key**
  - **用途**：安全Qdrant实例的身份验证密钥。
  - **行为**：此字段是可选的，只有在Qdrant部署需要API密钥时才应使用。

#### 高级配置字段

- **搜索评分阈值**
  - **用途**：控制代码片段被视为匹配所需的最低相似度评分。
  - **行为**：使用滑块设置0.0到1.0之间的值。较低的值返回更多（但可能不太相关的）结果，较高的值返回更少但更精确的结果。
  - **推荐设置**：
    - **低(0.15-0.3)**：更广泛的结果，适合探索
    - **中等(0.4-0.5)**：精度和召回率平衡（默认：0.4）
    - **高(0.6-0.8)**：仅精确匹配

- **最大搜索结果数**
  - **用途**：设置单个`codebase_search`返回的最大代码片段数。
  - **行为**：使用滑块调整限制。这有助于控制提供给AI的上下文量。

// ... existing code ...

### 模型问题

**"未找到模型"**
- 对于Google Gemini：确保模型名称正确（例如`text-embedding-004`）
- 对于其他提供商：查阅其文档了解可用模型和正确命名

### 索引问题

**"卡在错误状态"**
1. 首先检查连接问题
2. 在设置中点击"清除索引 & 重新索引"
3. 这可以解决缓存损坏或集合问题

**"索引耗时过长"**
- 大型代码库正常（10k+文件）
- 检查`.gitignore`是否包含大型目录
- 考虑在`.rooignore`中添加模式

// ... existing code ...

## 隐私 & 数据安全

**您的代码保持私有**：
- 只有小型代码块（100-1000个字符）发送进行嵌入
- 嵌入是一次性数学表示
- 本地解析意味着完整文件永远不会离开您的机器
- 使用Ollama实现完全离线操作

**数据存储**：
- 向量存储在您选择的Qdrant实例中
- 您控制数据存储的位置（本地/云端）
- 删除简单：只需清除索引即可

// ... existing code ...