# 自动批准操作

> ⚠️ **安全警告：** 自动批准设置会绕过确认提示，给予 Roo 直接访问系统的权限。这可能导致**数据丢失、文件损坏甚至更严重的问题**。命令行访问尤其危险，因为它可能会执行可能损坏系统或危及安全的操作。仅对您完全信任的操作启用自动批准。

自动批准设置通过消除重复的确认提示来加快工作流程，但它们显著增加了安全风险。

<div style={{ position: 'relative', paddingBottom: '56.25%', height: 0, overflow: 'hidden' }}>
  <iframe
    src="https://www.youtube.com/embed/jW4_PPyRXCs"
    style={{
      position: 'absolute',
      top: 0,
      left: 0,
      width: '100%',
      height: '100%',
    }}
    frameBorder="0"
    allow="autoplay; encrypted-media"
    allowFullScreen
  ></iframe>
</div>
<br />

\* **更新：** 自从本视频制作以来，我们添加了一个自动批准问题操作。[您可以在下面找到它](#follow-up-questions)!

---

## 快速入门指南

1. 点击聊天输入框上方的自动批准工具栏
2. 选择 Roo 在无需请求许可的情况下可以执行哪些操作
3. 使用主切换开关（最左侧复选框）快速启用/禁用所有权限

---

## 自动批准工具栏

<img src="/img/auto-approving-actions/auto-approving-actions.png" alt="折叠状态下的自动批准工具栏" width="600" />

*提示框和显示已启用权限的自动批准工具栏*

点击工具栏以展开并配置各个权限：

<img src="/img/auto-approving-actions/auto-approving-actions-1.png" alt="展开状态下的自动批准工具栏" width="600" />

*提示文本框和包含所有选项的展开工具栏*

### API 请求限制

工具栏包括一个输入字段，用于设置 Roo 可以自动发起的 API 请求的最大数量：

- **用途**：防止失控的 API 使用和意外费用
- **默认值**：无限制（空字段）
- **推荐**：根据任务复杂度设置合理限制（例如，大多数任务设置为50-100）
- **工作方式**：一旦达到限制，Roo 将暂停并请求继续权限

此安全功能在以下情况下特别有用：
- 使用昂贵的 API 模型时
- 测试新工作流时
- 让 Roo 长时间自主工作时

### 可用权限

| 权限 | 功能 | 风险等级 |
|------------|--------------|------------|
| **读取文件和目录** | 允许 Roo 无需询问即可访问文件 | 中等 |
| **编辑文件** | 允许 Roo 无需询问即可修改文件 | **高** |
| **执行已批准命令** | 自动运行白名单中的终端命令 | **高** |
| **使用浏览器** | 允许无头浏览器交互 | 中等 |
| **使用 MCP 服务器** | 允许 Roo 使用配置的 MCP 服务 | 中等-高 |
| **切换模式** | 自动在 Roo 模式之间切换 | 低 |
| **创建 & 完成子任务** | 无需确认即可管理子任务 | 低 |
| **重试失败请求** | 自动重试失败的 API 请求 | 低 |
| **回答后续问题** | 为后续问题选择默认答案 | 低 |
| **更新待办事项列表** | 自动更新任务进度 | 低 |

---

## 主切换开关实现快速控制

最左侧的复选框作为主切换开关：

<img src="/img/auto-approving-actions/auto-approving-actions-14.png" alt="自动批准工具栏中的主切换开关" width="600" />

*主切换开关（复选框）一次控制所有自动批准权限*

**工作方式：**
- **已勾选**：激活所有配置的自动批准权限
- **未勾选**：临时禁用所有自动批准而不更改单独设置
- **重要**：切换时保留单独的权限设置

这意味着您可以：
1. 一次性配置好首选权限
2. 使用主切换开关快速启用/禁用所有权限
3. 下次使用时仍保留您的配置

当以下情况时使用主切换开关：
- 在敏感代码中工作时（关闭）
- 进行快速开发时（开启）
- 在探索和编辑任务之间切换时
- 暂时暂停自动化而不丢失设置时

---

## 高级设置面板

设置面板提供了详细的控制和重要的安全上下文：

> **允许 Roo 在不需要审批的情况下自动执行操作。只有在您完全信任 AI 并理解相关安全风险时才启用这些设置。**

要访问这些设置：

1. 点击右上角的 <Codicon name="gear" /> 图标
2. 导航到自动批准设置

<img src="/img/auto-approving-actions/auto-approving-actions-19.png" alt="设置面板自动批准选项" width="550" />
*完整设置面板视图*

### 读取操作

:::info 读取操作（风险：中等）

<img src="/img/auto-approving-actions/auto-approving-actions-3.png" alt="只读操作设置" width="550" />

**设置：** "始终批准只读操作"

**描述：** "启用后，Roo 将自动查看目录内容和读取文件，而无需您点击批准按钮。"

**附加选项：**
- **包含工作区外的文件：** 允许 Roo 读取当前工作区目录外的文件

**风险等级：** 中等

虽然此设置仅允许读取文件（不修改它们），但它可能会暴露敏感数据。仍然推荐作为大多数用户的起点，但请注意 Roo 可以访问哪些文件。

#### 工作区边界保护

默认情况下，Roo 只能读取您当前工作区目录中的文件。"包含工作区外的文件"选项扩展了超出工作区边界的读取访问权限。考虑安全影响：

- **默认（未勾选）**：Roo 只能读取项目目录中的文件
- **启用**：Roo 可以读取您有访问权限的任何系统文件
- **建议**：除非您确实需要 Roo 访问外部文件，否则保持禁用状态
:::

### 写入操作

:::caution 写入操作（风险：高）
<img src="/img/auto-approving-actions/auto-approving-actions-16.png" alt="写入操作设置与延迟滑块" width="550" />

**设置：** "始终批准写入操作"

**描述：** "无需审批即可自动创建和编辑文件"

**延迟滑块：** "写入后的延迟时间以允许诊断检测潜在问题"（默认值：0ms）

**附加选项：**
- **包含工作区外的文件：** 允许 Roo 修改当前工作区目录外的文件
- **包含受保护文件：** 允许 Roo 修改通常受 .rooignore 和 .roo/ 目录保护的文件

**风险等级：** 高

此设置允许 Roo 无需确认即可修改您的文件。延迟计时器至关重要：
- 较高的值（2000ms+）：适用于诊断需要较长时间的复杂项目
- 默认值（0ms）：无延迟 - 在速度至关重要的时候使用
- 1000ms：适用于大多数带有活动诊断的项目
- 较低的值：仅在受控环境中使用

#### 安全边界

写入操作设置包含两个重要的安全控制：

1. **工作区边界保护**：默认情况下，Roo 只能修改当前工作区中的文件。启用 "包含工作区外的文件" 要格外小心。

2. **受保护文件**：.rooignore 中和 .roo/ 目录下的文件默认受保护。"包含受保护文件" 选项会绕过此保护 - 仅在必要时使用。

#### 写入延迟 & 问题面板集成

<img src="/img/auto-approving-actions/auto-approving-actions-5.png" alt="显示诊断信息的问题面板" width="600" />

*Roo 在写入延迟期间检查 VSCode 的问题面板*

当您启用写入文件的自动批准时，延迟定时器与 VSCode 的问题面板配合工作：

1. Roo 对文件进行更改
2. VSCode 的诊断工具分析更改
3. 问题面板用任何错误或警告更新
4. Roo 在继续之前注意到这些问题

这就像一个人类开发者在更改代码后暂停检查错误。您可以根据以下因素调整延迟时间：

- 项目的复杂性
- 语言服务器的速度
- 错误检测对您的工作流的重要性
:::

### 浏览器操作

:::info 浏览器操作（风险：中等）

**设置：** "始终批准浏览器操作"

**描述：** "无需审批即可自动执行浏览器操作"

**注意：** "仅在模型支持计算机使用时适用"

**风险等级：** 中等

允许 Roo 控制无头浏览器而无需确认。这可以包括：
- 打开网站
- 导航页面
- 与网页元素互动

考虑允许自动浏览器访问的安全影响。
:::

### API 请求

:::info API 请求（风险：低）
<img src="/img/auto-approving-actions/auto-approving-actions-17.png" alt="API 请求重试设置与延迟滑块" width="550" />

**设置：** "始终重试失败的 API 请求"

**描述：** "当服务器返回错误响应时，自动重试失败的 API 请求"

**延迟滑块：** "重试请求前等待的时间"（默认值：5秒）

**风险等级：** 低

此设置在请求失败时自动重试 API 调用。延迟控制 Roo 等待多长时间再尝试：
- 更长的延迟对 API 速率限制更温和
- 更短的延迟更快地从暂时性错误中恢复
:::

### MCP 工具

:::caution MCP 工具（风险：中等-高）

**设置：** "始终批准 MCP 工具"

**描述：** "启用对 MCP 服务器视图中单个 MCP 工具的自动批准（需要此设置和工具的个人 '始终允许' 复选框）"

**风险等级：** 中等-高（取决于配置的 MCP 工具）

此设置要求双重权限过程以确保安全：

1. **启用此全局设置** - 作为所有 MCP 工具自动批准的主开关
2. **启用个别工具权限** - 在 MCP 服务器视图中，为特定工具勾选 "始终允许" 复选框

**重要：** 要使工具自动批准，必须同时满足这两个权限。这种双权限系统可确保您保持对哪些 MCP 工具可以无确认执行的细粒度控制。

示例工作流：
- 在设置中启用 "始终批准 MCP 工具"
- 导航到 MCP 服务器视图
- 找到特定工具（如文件系统操作）
- 勾选其 "始终允许" 复选框
- 仅此特定工具将自动批准
:::

### 模式切换

:::info 模式切换（风险：低）

**设置：** "始终批准模式切换"

**描述：** "无需审批即可在不同模式之间切换"

**风险等级：** 低

允许 Roo 在不同模式（代码、架构师等）之间切换而无需请求权限。这主要影响 AI 的行为而非系统访问。
:::

### 子任务

:::info 子任务（风险：低）

**设置：** "始终批准子任务的创建 & 完成"

**描述：** "无需审批即可创建和完成子任务"

**风险等级：** 低

启用 Roo 自动创建和完成子任务。这关系到工作流组织而非系统访问。
:::

### 命令执行

:::caution 命令执行（风险：高）
<img src="/img/auto-approving-actions/auto-approving-actions-18.png" alt="带白名单界面的命令执行设置" width="550" />

**设置：** "始终批准允许的执行操作"

**描述：** "在启用 '始终批准执行操作' 时，自动执行白名单中的终端命令，无需审批"

**命令管理：** "当启用 '始终批准执行操作' 时，可以自动执行的命令前缀。添加 * 以允许所有命令（谨慎使用）。"

**风险等级：** 高

此设置允许终端命令执行，但有一些控制措施。虽然很危险，但白名单功能限制了可以运行的命令。重要的安全特性：

- 白名单特定命令前缀（推荐）
- 生产环境或处理敏感数据时永远不要使用 * 通配符
- 考虑每个允许命令的安全影响
- 始终验证与外部系统交互的命令

**界面元素：**
- 输入命令前缀的文本字段
- "添加" 按钮以添加新前缀
- 可点击的命令按钮及其 X 删除它们

**常见白名单示例：**
- `git` - 版本控制操作
- `npm run` - 运行 package.json 脚本
- `python -m pytest` - 运行 Python 测试
- `cargo test` - 运行 Rust 测试
- `go test` - 运行 Go 测试
- `docker ps` - 列出 Docker 容器
- `ls` - 列出目录内容
- `cat` - 显示文件内容

**安全提示：** 对于前缀要具体。而不是允许所有 `python` 命令，将其限制为 `python -m pytest` 以仅用于测试执行。
:::

### 后续问题

:::info 后续问题（风险：低）
<img src="/img/auto-approving-actions/auto-approving-actions-15.png" alt="带超时滑块的后续问题操作设置" width="550" />

**设置：** `始终为后续问题选择默认答案`

**描述：** 自动选择第一个 AI 建议的答案，经过可配置的超时时间后继续。这通过让 Roo 无需人工干预即可继续工作来加速您的工作流。

**可视化倒计时：** 当启用时，在第一个建议按钮上显示倒计时，显示剩余的自动选择时间。倒计时以圆形进度指示器的形式显示，随着剩余时间减少而耗尽。

**超时滑块：** 使用滑块设置等待时间从1到300秒（默认值：60秒）。

**覆盖选项：** 您可以通过以下方式随时取消自动选择：
- 点击其他建议
- 编辑任何建议
- 输入自己的回复
- 点击计时器暂停

**风险等级：** 低

**使用场景：**
- 您希望 Roo 整夜运行时
- 重复性任务中默认建议通常是正确的
- 不需要交互的测试工作流中
:::

### 更新待办事项列表

:::info 更新待办事项列表（风险：低）

**设置：** "始终批准待办事项列表更新"

**描述：** "无需审批即可自动更新待办事项列表"

**风险等级：** 低

此设置允许 Roo 在工作过程中自动更新任务进度和待办事项列表。这包括：
- 标记任务为已完成
- 添加新发现的任务
- 更新任务状态（挂起、进行中、已完成）
- 重新组织任务优先级

**优点：**
- 维持实时任务进度可见性
- 减少多步骤工作流中的中断
- 保持项目状态准确反映
- 帮助跟踪复杂的任务依赖关系

**使用场景：**
- 长时间运行的开发会话
- 多步骤重构项目
- 复杂的调试工作流
- 包含许多子任务的功能实现

当与子任务权限结合使用时，这一点尤其有用，因为这允许 Roo 在没有持续审批请求的情况下维护完整的项目进度图。
:::
