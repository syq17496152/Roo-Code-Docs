# 自定义指令

自定义指令允许您个性化Roo的行为，提供特定指导来塑造响应方式、编码风格和决策流程。

:::info 指令文件位置
您可以使用全局规则（应用于所有项目）、工作区规则（项目特定）或通过提示标签界面提供自定义指令。

**全局规则目录：** 自动应用于所有项目
*   **Linux/macOS:** `~/.roo/rules/` 和 `~/.roo/rules-{modeSlug}/`
*   **Windows:** `%USERPROFILE%\.roo\rules\` 和 `%USERPROFILE%\.roo\rules-{modeSlug}\`

**工作区规则：** 仅应用于当前项目，可覆盖全局规则
*   **推荐方法：目录形式（`.roo/rules/`）**
    ```
    .
    ├── .roo/
    │   └── rules/          # 工作区范围规则
    │       ├── 01-通用.md
    │       └── 02-编码风格.txt
    └── ... (其他项目文件)
    ```
*   **备选方法：单文件形式（`.roorules`）**
    ```
    .
    ├── .roorules           # 工作区范围规则（单文件）
    └── ... (其他项目文件)
    ```

**模式特定指令：** 仅应用于特定模式（如`code`）
*   **推荐方法：目录形式（`.roo/rules-{modeSlug}/`）**
    ```
    .
    ├── .roo/
    │   └── rules-code/     # "代码"模式规则
    │       ├── 01-js-风格.md
    │       └── 02-ts-风格.md
    └── ... (其他项目文件)
    ```
*   **备选方法：单文件形式（`.roorules-{modeSlug}`）**
    ```
    .
    ├── .roorules-code      # "代码"模式规则（单文件）
    └── ... (其他项目文件)
    ```

规则按顺序加载：先全局规则，后工作区规则（可覆盖全局规则）。详见[全局规则目录](#全局规则目录)。
:::

---

## 什么是自定义指令？

自定义指令定义Roo基本角色之外的行为、偏好和约束。示例包括编码风格、文档标准、测试要求和工作流指南。

---

## 设置自定义指令

### 全局自定义指令

这些指令适用于所有工作区，保持您的偏好设置，无论您正在处理什么项目。

**如何设置：**

<img src="/img/custom-instructions/custom-instructions.png" alt="Roo Code提示标签显示全局自定义指令界面" width="600" />
1.  **打开提示标签：** 点击Roo Code顶部菜单栏的<Codicon name="notebook" />图标
2.  **找到部分：** 找到"所有模式的自定义指令"部分
3.  **输入指令：** 在文本区域输入您的指令
4.  **保存更改：** 点击"完成"保存更改

### 全局规则目录

全局规则目录功能提供可重用规则和自定义指令，自动应用于所有项目。此系统支持全局配置和项目特定覆盖。

#### 主要优势

**无全局规则时：** 您必须在每个项目中维护相同规则：
- 将相同规则复制到每个新项目
- 手动更新多个项目的规则
- 项目间不一致

**使用全局规则：** 一次创建规则，处处使用：
- 设置全局编码标准
- 按需覆盖项目特定规则
- 保持所有项目一致性
- 一键更新所有项目规则

#### 目录结构

全局规则目录位置是固定的，无法自定义：

**Linux/macOS：**
```
~/.roo/                           # 您的全局Roo配置
├── rules/                        # 应用于所有项目的通用规则
│   ├── 编码标准.md
│   ├── 格式规则.md
│   └── 安全指南.md
├── rules-code/                   # 代码模式特定规则
│   ├── typescript规则.md
│   └── 测试要求.md
├── rules-docs-extractor/         # 文档抽取器规则
│   └── 文档风格.md
└── rules-{mode}/                 # 其他特定模式规则
    └── 模式特定规则.md
```

**Windows：**
```
%USERPROFILE%\.roo\               # 您的全局Roo配置
├── rules\                        # 应用于所有项目的通用规则
│   ├── 编码标准.md
│   ├── 格式规则.md
│   └── 安全指南.md
├── rules-code\                   # 代码模式特定规则
│   ├── typescript规则.md
│   └── 测试要求.md
└── rules-{mode}\                 # 其他特定模式规则
    └── 模式特定规则.md
```

#### 设置全局规则

1. **创建全局规则目录：**
   ```bash
   # Linux/macOS
   mkdir -p ~/.roo/rules
   
   # Windows
   mkdir %USERPROFILE%\.roo\rules
   ```

2. **添加通用规则（`~/.roo/rules/编码标准.md`）：**
   ```markdown
   # 全局编码标准
   
   1. 新项目始终使用TypeScript
   2. 为所有新函数编写单元测试
   3. 使用描述性变量名
   4. 为公共API添加JSDoc注释
   ```

3. **添加模式特定规则（`~/.roo/rules-code/typescript规则.md`）：**
   ```markdown
   # TypeScript代码模式规则
   
   1. tsconfig.json中使用严格模式
   2. 对对象形状优先使用接口而非类型别名
   3. 始终指定函数返回类型
   ```

#### 可用规则目录

| 目录 | 用途 |
|-----------|---------|
| `rules/` | 应用于所有模式的通用规则 |
| `rules-code/` | 代码模式特定规则 |
| `rules-docs-extractor/` | 文档抽取器规则 |
| `rules-architect/` | 系统架构任务规则 |
| `rules-debug/` | 调试工作流规则 |
| `rules-{mode}/` | 任何自定义模式的规则 |

#### 规则加载顺序

规则按以下顺序加载：

1. **全局规则**（来自`~/.roo/`）
2. **项目规则**（来自`project/.roo/`）- 可覆盖全局规则
3. **遗留文件**（`.roorules`, `.clinerules` - 用于向后兼容）

在每个级别内，模式特定规则先于通用规则加载。

### 工作区级指令

这些指令仅适用于当前工作区，允许您为特定项目自定义Roo Code的行为。

#### 通过文件/目录设置工作区范围指令

工作区范围指令适用于当前项目的所有模式，可通过文件定义：

*   **推荐方法：基于目录（`.roo/rules/`）**
    *   在工作区根目录创建名为`.roo/rules/`的目录。
    *   在目录内放置指令文件（如`.md`、`.txt`）。Roo Code递归读取文件，按文件名**字母顺序**将内容附加到系统提示中。
    *   如果目录存在且包含文件，此方法优先。
*   **备选方法：基于文件（`.roorules`）**
    *   如果`.roo/rules/`不存在或为空，Roo Code会查找工作区根目录中的单个`.roorules`文件。
    *   如果找到，加载其内容。

#### 模式特定指令

模式特定指令可通过两种独立方式设置，可同时使用：

1.  **使用提示标签：**

    <img src="/img/custom-instructions/custom-instructions-2.png" alt="Roo Code提示标签显示模式特定自定义指令界面" width="600" />
    * **打开标签：** 点击Roo Code顶部菜单栏的<Codicon name="notebook" />图标
    * **选择模式：** 在模式标题下，点击要自定义的模式按钮
    * **输入指令：** 在"模式特定自定义指令（可选）"下输入文本区域
    * **保存更改：** 点击"完成"保存更改

        :::info 全局模式规则
        如果模式本身是全局的（非工作区特定），为此模式设置的任何自定义指令也将全局应用于该模式。
        :::

2.  **使用规则文件/目录：** 通过文件提供模式特定指令：
    *   **推荐方法：基于目录（`.roo/rules-{modeSlug}/`）**
        *   在工作区根目录创建名为`.roo/rules-{modeSlug}/`（如`.roo/rules-docs-writer/`）的目录。
        *   在目录内放置指令文件（递归加载）。文件按文件名**字母顺序**附加到系统提示中。
        *   如果目录存在且包含文件，此方法优先于备选文件方法。
    *   **备选方法：基于文件（`.roorules-{modeSlug}`）**
        *   如果`.roo/rules-{modeSlug}/`不存在或为空，Roo Code会查找工作区根目录的单个`.roorules-{modeSlug}`文件（如`.roorules-code`）。
        *   如果找到，加载其内容。

从提示标签、全局规则、工作区规则和模式特定规则获取的指令都会合并。详见下文的精确顺序。

---

## 指令合并方式

指令以以下精确格式插入系统提示：

```
====
用户自定义指令

以下附加指令由用户提供，应尽可能遵循，不得干扰工具使用指南。

[语言偏好（如设置）]

[全局指令（来自提示标签）]

[模式特定指令（来自提示标签当前模式）]

全局规则（来自~/.roo/）：
[~/.roo/rules-{modeSlug}/文件内容（如目录存在且非空）]
[~/.roo/rules/文件内容（如目录存在且非空）]

模式特定指令（来自文件/目录）：
[.roo/rules-{modeSlug}/文件内容（如目录存在且非空）]
[.roorules-{modeSlug}文件内容（如目录不存在或为空，且文件存在）]

工作区范围指令（来自文件/目录）：
[.roo/rules/文件内容（如目录存在且非空）]
[.roorules文件内容（如目录不存在或为空，且文件存在）]

====
```

*注意：先加载全局规则，后加载工作区规则（可覆盖）。模式特定规则在每个级别中优先于通用规则，目录规则优先于文件备选。*

---

## 关于.rules文件的规则

* **文件位置：** 推荐方法使用`.roo/`内的目录（`.roo/rules/`和`.roo/rules-{modeSlug}/`）。备选方法使用工作区根目录的单个文件（`.roorules`和`.roorules-{modeSlug}`）。
* **空文件：** 空或缺失的规则文件会自动跳过
* **源文件头：** 每个规则文件内容包含指示来源的头信息
* **规则交互：** 模式特定规则补充而非取代全局规则

---

## 自定义指令示例

* "始终使用空格缩进，宽度为4个空格"
* "变量名使用camelCase"
* "为所有新函数编写单元测试"
* "提供代码前先解释推理过程"
* "注重代码可读性和可维护性"
* "优先使用社区最常用库"
* "为网站添加新功能时，确保响应式和可访问"

:::tip 专业提示：团队标准化
对于团队环境，考虑以下方法：

**项目标准：** 在版本控制中使用工作区`.roo/rules/`目录标准化特定项目的Roo行为。确保团队成员间代码风格和开发流程一致性。

**组织标准：** 使用全局规则（`~/.roo/rules/`）建立适用于所有项目的组织编码标准。团队成员设置相同全局规则以保持所有工作一致性。

**混合方法：** 结合全局规则（组织标准）与项目特定工作区规则（项目需求）。工作区规则可按需覆盖全局规则。

目录方法比单个`.roorules`文件更易组织，支持全局和项目级定制。
:::

---

## 与自定义模式结合

高级定制时，结合[自定义模式](/features/custom-modes)创建具有特定工具访问、文件限制和定制指令的专用环境。